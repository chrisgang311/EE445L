(function(){"use strict";TS.registerModule("client.ui.unread",{$channel_pane_item:$("#channels_scroller .all_unreads"),$scroller:$("#unread_msgs_scroller_div"),$unread_msgs_div:null,$container:null,unread_groups:[],showUnreadView:function(){TS.channels.renamed_sig.add(_onRename);TS.groups.renamed_sig.add(_onRename);$("#client-ui").addClass("unread_view_is_showing");$("#msgs_scroller_div").addClass("hidden");$("#archives_return").addClass("hidden");if(TS.model.ui_state.flex_name==="details")TS.client.ui.flex.hideFlex(true);var skip_mark_msgs_read_immediate_check=true;TS.client.msg_pane.hideNewMsgsBar(skip_mark_msgs_read_immediate_check);TS.client.ui.unread.$scroller.html(TS.templates.unread_main());TS.client.ui.unread.$unread_msgs_div=$("#unread_msgs_div");if(TS.environment.supports_custom_scrollbar){TS.client.ui.unread.$container=$("#unread_msgs_scroller_div")}else{TS.client.ui.unread.$scroller.monkeyScroll();TS.client.ui.unread.$container=$("#monkey_scroll_wrapper_for_unread_msgs_scroller_div")}$("#footer").addClass("invisible");_onResize();TS.view.resize_sig.add(_onResize);TS.client.ui.unread.$unread_msgs_div.on("click.unread",".bottom_mark_all_read_btn",function(){TS.client.unread.markAllAsRead()});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_mark",function(e){var model_ob_id=$(e.target).closest(".unread_group").data("model-id");var group=TS.client.unread.getGroup(model_ob_id);if(!group||group.marked_as_read)return;TS.client.ui.unread.markGroupAsRead(model_ob_id)});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_undo",function(e){TS.client.ui.unread.markGroupAsUnread($(e.target).closest(".unread_group").data("model-id"))});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_header_name .channel_link, .unread_group_header_name .mpim_link, .unread_group_header_name .internal_im_link",function(e){if(TS.client.unread.shouldRecordMetrics())TS.metrics.count("unread_view_channel_navigation")});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_new",function(e){var group=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(group.collapsed){if(group.marked_as_read){TS.client.unread.moveNewUnreadsOntoHiddenMsgs(group)}TS.client.ui.unread.expandGroup(group)}else{TS.client.ui.unread.updateGroupWithNewMessages(group)}});TS.client.ui.unread.$unread_msgs_div.on("click.unread",".unread_group_collapse_toggle",function(e){var group=TS.client.unread.getGroup($(e.target).closest(".unread_group").data("model-id"));if(group){if(group.collapsed){TS.client.ui.unread.expandGroup(group,{persist_state:true})}else{var $group=_getGroupElement(group);var $msgs_holder=$group.find(".unread_group_msgs");TS.client.ui.unread.collapseGroup(group,$msgs_holder,{persist_state:true})}}});if(!TS.model.supports_sticky_position){if($("body").hasClass("banner_showing")){_updateBannerHeight()}TS.ui.banner.show_hide_sig.add(_updateBannerHeight);var updated_sig=new signals.Signal;_throttled_update_sticky_header=_.throttle(_updateStickyHeader,16);TS.client.ui.unread.$scroller.on("scroll",_throttled_update_sticky_header);updated_sig.add(_updateUnreadGroupPositions)}_msgs_config={name:"unread",container:$("#unread_msgs_div"),scroller:$("#unread_msgs_scroller_div"),page_size:25,sections:[],has_more_beginning:false,has_more_end:false,updated_sig:updated_sig,promiseToLoadMoreAtEnd:function(){return TS.client.ui.unread.promiseToShowNextPage()},buildMsgHTML:function(msg,prev_msg,section){var $msg=$(TS.templates.builders.buildMsgHTML({msg_dom_id:TS.templates.makeMsgDomIdInUnreadView(msg.ts),msg:msg,model_ob:section.model_ob,prev_msg:prev_msg,container_id:"unread_msgs_div",enable_slack_action_links:true,hide_actions:false}));if(_fade_in_messages)$msg.css("opacity",0);return $msg},buildSection:function(section){return TS.templates.unread_group(_buildTemplateArgs(section))},buildDayDivider:function(section,msg){var ts=msg.ts;var date=TS.utility.date.toDateObject(ts);var is_today=TS.utility.date.isToday(date);var $divider=$(TS.templates.unread_day_divider({ts:ts,is_today:is_today}));if(_fade_in_messages)$divider.css("opacity",0);return $divider}};TS.ui.message_container.register(_msgs_config);_preloadEmptyState();TS.client.ui.rebuildAllButMsgs();TS.client.ui.unread.promiseToShowNextPage().then(function(){if(TS.client.unread.shouldRecordMetrics())TS.metrics.measureAndClear("unread_view_time_to_display","unread_view_time_to_display");if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length){_transitionToMessages()}else{TS.client.ui.unread.displayEmptyState()}})},promiseToShowNextPage:function(){_currently_loading_more_promise=TS.client.unread.promiseToGetMoreMessages().then(function(msgs_data){if(!TS.model.unread_view_is_showing)return;_.forEach(msgs_data.groups,function(data_ob){var group=TS.client.unread.getGroup(data_ob.id);var inx=_.findIndex(_msgs_config.sections,{id:group.id});if(-1===inx){_msgs_config.sections.push(group)}});_msgs_config.has_more_end=!!msgs_data.has_more;_onResize();_checkToShowEmptyState();_currently_loading_more_promise=null;return null}).catch(_.noop);return _currently_loading_more_promise},removeMessageContainerGroup:function(model_ob_ids){_msgs_config.sections=_msgs_config.sections.filter(function(section){return model_ob_ids.indexOf(section.id)===-1});_msgs_config.has_more_end=true;return _msgs_config},restart:function(){TS.client.ui.unread.showOrHideRefreshButton();TS.ui.message_container.cleanup(_msgs_config);TS.client.ui.unread.$unread_msgs_div.empty();_msgs_config.sections=[];_msgs_config.has_more_end=false;TS.ui.message_container.register(_msgs_config);TS.client.ui.unread.$scroller.addClass("loading");_preloadEmptyState();TS.client.ui.unread.promiseToShowNextPage().then(function(){if(!TS.model.unread_view_is_showing)return;if(TS.client.unread.getAllGroups().length){_transitionToMessages()}else{TS.client.ui.unread.displayEmptyState()}})},displaySlowLoadingMessage:function(){if(TS.client.ui.unread.$scroller.hasClass("loading"))TS.client.ui.unread.$scroller.addClass("loading-slow")},isFatalErrorDisplaying:function(){return $("#messages_container .unread_error_state").length},displayFatalError:function(){TS.client.ui.unread.$scroller.addClass("invisible");$("#messages_container .unread_empty_state").remove();$("#messages_container").prepend(TS.templates.unread_error({emoji:new Handlebars.SafeString(TS.emoji.graphicReplace(":tropical_fish:",{jumbomoji:true}))}));$(".unread_error_state_refresh_button").on("click",function(){TS.client.unread.reload()});_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning")})},displayEmptyState:function(marked_as_read_cnt){TS.client.ui.unread.$scroller.addClass("invisible");$("#messages_container .unread_empty_state").remove();$("#messages_container").prepend(TS.templates.unread_empty_state({line_one:_preloaded_empty_state.line_one,line_two:_preloaded_empty_state.line_two,emoji:_preloaded_empty_state.emoji_url}));_.defer(function(){$("#messages_container .unread_empty_state").addClass("transitioning")});_updateChannelHeaderCount(0);if(marked_as_read_cnt){$(".unread_empty_state_undo").remove();$("#footer").removeClass("invisible").append(TS.templates.unread_empty_state_undo({marked_as_read_cnt:marked_as_read_cnt})).find(".unread_empty_state_undo").css({bottom:"-36px"}).animate({bottom:0},300).delay(1e4).animate({bottom:"-36px"},300);$(".unread_empty_state_undo_action").on("click",function(){TS.client.unread.markAllAsUnread();_updateChannelHeaderCount(TS.client.unread.getTotalMessagesCount())})}TS.client.ui.unread.showOrHideRefreshButton()},removeEmptyState:function(){$(window).off("keydown.unread");$("#messages_container .unread_empty_state").remove();$(".unread_empty_state_undo").remove();$("#footer").addClass("invisible");TS.client.ui.unread.$scroller.removeClass("invisible")},showOrHideRefreshButton:function(){var $empty=$("#messages_container .unread_empty_state");var $refresh=$(".unread_empty_state_refresh");if($empty.length&&TS.client.unread.new_messages_in_channels.length&&!$empty.hasClass("unread_error_state")){if($refresh.length>0){$refresh.replaceWith(TS.templates.unread_empty_state_refresh({unreads_count:TS.client.unread.getTotalNewUnreadCount()}))}else{$(".unread_empty_state").append(TS.templates.unread_empty_state_refresh({unreads_count:TS.client.unread.getTotalNewUnreadCount()}));$(window).on("keydown.unread",function(e){if(TS.model.unread_view_is_showing&&e.which==TS.utility.keymap.enter&&TS.client.ui.isUserAttentionOnChat()&&!TS.utility.isFocusOnInput()){TS.client.unread.reload()}})}$(".unread_empty_state_refresh_button").on("click",function(){TS.client.unread.reload()})}if(TS.client.unread.new_messages_in_channels.length){$("#channel_header_unread_refresh").removeClass("hidden")}else{$("#channel_header_unread_refresh").addClass("hidden");if($refresh)$refresh.remove()}},destroyUnreadView:function(){if(!TS.client.ui.unread.isUnreadViewDOMShowing())return;var $client_ui=$("#client-ui");$client_ui.removeClass("unread_view_is_showing");$("#msgs_scroller_div").removeClass("hidden");TS.ui.message_container.cleanup(_msgs_config);_msgs_config=null;TS.client.ui.unread.removeEmptyState();TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_mark");TS.client.ui.unread.$unread_msgs_div.off("click.unread",".unread_group_undo");if(!TS.model.supports_sticky_position){TS.client.ui.unread.$scroller.off("scroll",_throttled_update_sticky_header);TS.ui.banner.show_hide_sig.remove(_updateBannerHeight)}TS.client.ui.unread.$unread_msgs_div.empty();TS.client.ui.unread.$scroller.addClass("loading");$("#footer").removeClass("invisible");TS.view.resize_sig.remove(_onResize);TS.channels.renamed_sig.remove(_onRename);TS.groups.renamed_sig.remove(_onRename);if(!TS.model.ui_state.flex_name&&TS.model.ui_state.details_tab_active){TS.client.ui.flex.openFlexTab("details",true)}},isUnreadViewDOMShowing:function(){return $("#client-ui").hasClass("unread_view_is_showing")},collapseGroup:function(group,$msgs_holder,opts){opts=_.extend({persist_state:false,add_classname:true},opts||{});if(group.collapsed)return Promise.resolve(group);TS.client.unread.collapseGroup(group,opts.persist_state);return new Promise(function(resolve,reject){var $group=_getGroupElement(group);var collapsed_group_offset=$group.offset().top;$group.addClass("collapsing");TS.client.ui.unread.updateHeader(group);$msgs_holder.animate({opacity:0},300,function(){$group.removeClass("collapsing");if(opts.add_classname)$group.addClass("collapsed");TS.client.ui.unread.updateMsgs();if(collapsed_group_offset<0){var $scroller=$group.closest(".monkey_scroller");if(!$scroller.length)$scroller=$group.closest(":scrollable(vertical)");if($scroller.is("html"))$scroller=$("body");$scroller.scrollTop(Math.round($group[0].offsetTop-8))}_updateUnreadGroupPositions();if(!TS.model.supports_sticky_position)_updateStickyHeader();$msgs_holder.css("opacity",1);resolve(group)})})},expandGroup:function(group,opts){opts=_.extend({persist_state:false},opts||{});if(!group.collapsed)return Promise.resolve(group);return new Promise(function(resolve,reject){TS.client.unread.expandGroup(group,opts.persist_state);var $group=_getGroupElement(group);TS.client.ui.unread.updateHeader(group);$group.removeClass("collapsed");$group.removeClass("marked_as_read");$group.removeClass("with_footer");_fade_in_messages=true;TS.client.ui.unread.$unread_msgs_div.css("height",TS.client.ui.unread.$unread_msgs_div.height());var changes=TS.client.ui.unread.updateMsgsWithFocus($group);_fade_in_messages=false;if(_currently_loading_more_promise){_currently_loading_more_promise.then(function(){TS.client.ui.unread.$unread_msgs_div.css("height","auto")})}else{TS.client.ui.unread.$unread_msgs_div.css("height","auto")}TS.client.ui.unread.updateNewMessagesMessage(group);changes.added.forEach(function($msg){$msg.animate({opacity:1},300)});_updateUnreadGroupPositions();if(!TS.model.supports_sticky_position)_updateStickyHeader();resolve(group)})},markGroupAsRead:function(model_ob_id){var group=TS.client.unread.getGroup(model_ob_id);if(!group)return;TS.client.unread.markGroupAsRead(group);_updateChannelHeaderCount(TS.client.unread.getTotalMessagesCount());var $group=_getGroupElement(group);var $msgs_holder=$group.find(".unread_group_msgs");if(group.new_unread_cnt<1){$group.addClass("marked_as_read")}if($msgs_holder.length){if(group.collapsed){TS.client.ui.unread.updateHeader(group)}else{var opts={add_classname:group.new_unread_cnt<1};TS.client.ui.unread.collapseGroup(group,$msgs_holder,opts).then(function(group){if(group.new_unread_cnt>0){TS.client.ui.unread.updateGroupWithNewMessages(group)}else{TS.client.ui.unread.updateHeader(group)}})}if(!group.new_unread_cnt){_checkToShowEmptyState()}}else{TS.client.ui.unread.updateMsgs()}},markGroupAsUnread:function(model_ob_id){var group=TS.client.unread.getGroup(model_ob_id);if(!group)return;TS.client.unread.markGroupAsUnread(group);TS.client.ui.unread.expandGroup(group);_updateChannelHeaderCount(TS.client.unread.getTotalMessagesCount())},updateNewMessagesMessage:function(group){if(group.has_more)return;var $group=_getGroupElement(group);var $group_footer=$group.find(".unread_group_footer");if(group.collapsed){TS.client.ui.unread.updateHeader(group)}else{if(group.new_unread_cnt>0&&group.new_unread_msgs){$group_footer.find(".unread_group_new_text").text(group.new_unread_cnt+" "+TS.utility.pluralize(group.new_unread_cnt,"new message","new messages"));$group.addClass("with_footer")}else if($group_footer){$group.removeClass("with_footer")}}},updateHeader:function(group){var $group=_getGroupElement(group);$group.find(".unread_group_header").html(TS.templates.unread_group_header(_buildTemplateArgs(group)))},updateMsgs:function(){return TS.ui.message_container.update(_msgs_config)},updateMsgsWithFocus:function($section){return TS.ui.message_container.updateWithFocus(_msgs_config,$section)},updateGroupWithNewMessages:function(group){var $group=_getGroupElement(group);var original_height=$group.height();$group.height(original_height);TS.client.unread.updateGroupWithNewMessages(group);_fade_in_messages=true;var changes=TS.client.ui.unread.updateMsgsWithFocus($group);_fade_in_messages=false;$group.css("height","auto");var new_height=$group.height();$group.removeClass("with_footer");$group.height(original_height).animate({height:new_height,margin:0},300,function(){$group.css("height","");$group.css("margin","");changes.added.forEach(function($msg){$msg.animate({opacity:1},300)})});$group.removeClass("collapsed").removeClass("marked_as_read");TS.client.ui.unread.updateHeader(group);_updateUnreadGroupPositions()},updateSidebarLink:function(){if(TS.model.unread_view_is_showing){$("#channels_scroller li.active").removeClass("active");$('li[data-action="show_unread_view"]').addClass("active")}else{$('li[data-action="show_unread_view"]').removeClass("active")}},toggleUnreadView:function(){if(TS.model.prefs.enable_unread_view){$(".channels_nav_unread").removeClass("hidden");$("#channels_nav").addClass("unread_enabled")}else{$(".channels_nav_unread").addClass("hidden");$(".all_unreads").removeClass("active");$("#channels_nav").removeClass("unread_enabled")}},updateChannelPaneUnreadState:function(is_unread){TS.client.ui.unread.$channel_pane_item.toggleClass("unread",is_unread)},rebuildMsgFile:function(msg,file){var $msg=TS.client.ui.unread.$unread_msgs_div.find("#"+TS.templates.makeMsgDomIdInUnreadView(msg.ts));if(!$msg||!$msg.length)return;var $file_container=$msg.find(".file_container");if(!$file_container||!$file_container.length)return;var data={file:file,is_message:true,msg_dom_id:$msg.attr("id")};if(file.mode==="post"||file.mode==="space"){$file_container.replaceWith(TS.templates.file_post(data))}else if(file.mode==="snippet"){$file_container.replaceWith(TS.templates.file_snippet(data))}else if(file.mode==="email"){$file_container.replaceWith(TS.templates.file_email(data))}else if(file.mode==="multnomah"){$file_container.replaceWith(TS.templates.file_multnomah(data))}else{return TS.warn("Trying to rebuild message file, but cannot rebuild "+file.mode)}TS.utility.makeSureAllLinksHaveTargets($msg);TS.ui.utility.updateClosestMonkeyScroller($msg)}});var _msgs_config;var _fade_in_messages=false;var $_currently_sticky=false;var _throttled_update_sticky_header;var _banner_height=0;var _preloaded_empty_state;var _currently_loading_more_promise=null;var CLIENT_HEADER_OVERHANG=8;var _preloadEmptyState=function(){var done_message_combo_options=[{emoji:"tada",skintone:false,line_one:"Ta-da!",line_two:"You’ve read everything there is to read."},{emoji:"victory",skintone:true,line_one:"All caught up.",line_two:"What’s next?"},{emoji:"ok",skintone:true,line_one:"There.",line_two:"All caught up."},{emoji:"rocket",skintone:false,line_one:"All done.",line_two:"The future is yours."},{emoji:"octopus",skintone:false,line_one:"All done.",line_two:"The world is your oyster."},{emoji:"high5",skintone:true,line_one:"That’s everything!",line_two:""},{emoji:"apple",skintone:false,line_one:"You’ve read all you needed.",line_two:"Take a moment."},{emoji:"sunglasses",skintone:false,line_one:"All clear.",line_two:""},{emoji:"thumbup",skintone:true,line_one:"That’s that.",line_two:"You’re good to go."},{emoji:"boom",skintone:false,line_one:"Boom.",line_two:"You’re up to date."},{emoji:"bee",skintone:false,line_one:"You’re up to date.",line_two:"Go forth and do great things."},{emoji:"clap",skintone:true,line_one:"Everything unread is now read.",line_two:"You’ve done it."},{emoji:"crystalball",skintone:false,line_one:"All that was unread is now read.",line_two:"What’s next?"},{emoji:"tada",skintone:false,line_one:"Ta-da!",line_two:"You’re up to date."},{emoji:"tractor",skintone:false,line_one:"You’re all read.",line_two:"Here’s a tractor."},{emoji:"pony",skintone:false,line_one:"You’re all read.",line_two:"Here’s a pony."},{emoji:"chick",skintone:false,line_one:"Everything’s sorted!",line_two:"Let’s start something new."},{emoji:"sun",skintone:false,line_one:"You’re all caught up!",line_two:"Clear screens ahead."},{emoji:"balloon",skintone:false,line_one:"There! Caught up.",line_two:"Set your mind to something new."},{emoji:"sweetpotato",skintone:false,line_one:"Sweet potato!",line_two:"You’re all done."},{emoji:"leafs",skintone:false,line_one:"Done and done.",line_two:""}];var emoji_paths={"default":{tada:cdn_url+"/42c04/img/unread/empty/default/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/default/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/default/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/default/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/default/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/default/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/default/victory_6.png"},ok:{1:cdn_url+"/42c04/img/unread/empty/default/ok_1.png",2:cdn_url+"/42c04/img/unread/empty/default/ok_2.png",3:cdn_url+"/42c04/img/unread/empty/default/ok_3.png",4:cdn_url+"/42c04/img/unread/empty/default/ok_4.png",5:cdn_url+"/42c04/img/unread/empty/default/ok_5.png",6:cdn_url+"/42c04/img/unread/empty/default/ok_6.png"},rocket:cdn_url+"/42c04/img/unread/empty/default/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/default/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/default/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/default/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/default/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/default/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/default/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/default/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/default/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/default/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/default/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/default/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/default/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/default/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/default/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/default/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/default/boom.png",bee:cdn_url+"/42c04/img/unread/empty/default/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/default/clap_1.png",2:cdn_url+"/42c04/img/unread/empty/default/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/default/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/default/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/default/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/default/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/default/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/default/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/default/pony.png",chick:cdn_url+"/42c04/img/unread/empty/default/chick.png",sun:cdn_url+"/42c04/img/unread/empty/default/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/default/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/default/sweetpotato.png",leafs:cdn_url+"/7fa97/img/unread/empty/default/leafs.png"},google:{tada:cdn_url+"/42c04/img/unread/empty/google/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/google/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/google/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/google/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/google/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/google/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/google/victory_6.png"},ok:{1:cdn_url+"/42c04/img/unread/empty/google/ok_1.png",2:cdn_url+"/42c04/img/unread/empty/google/ok_2.png",3:cdn_url+"/42c04/img/unread/empty/google/ok_3.png",4:cdn_url+"/42c04/img/unread/empty/google/ok_4.png",5:cdn_url+"/42c04/img/unread/empty/google/ok_5.png",6:cdn_url+"/42c04/img/unread/empty/google/ok_6.png"},rocket:cdn_url+"/42c04/img/unread/empty/google/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/google/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/google/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/google/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/google/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/google/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/google/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/google/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/google/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/google/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/google/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/google/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/google/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/google/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/google/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/google/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/google/boom.png",bee:cdn_url+"/42c04/img/unread/empty/google/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/google/clap_1.png",2:cdn_url+"/d90ef/img/unread/empty/google/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/google/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/google/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/google/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/google/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/google/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/google/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/google/pony.png",chick:cdn_url+"/42c04/img/unread/empty/google/chick.png",sun:cdn_url+"/42c04/img/unread/empty/google/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/google/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/google/sweetpotato.png",leafs:cdn_url+"/7fa97/img/unread/empty/google/leafs.png"},twitter:{tada:cdn_url+"/42c04/img/unread/empty/twitter/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/twitter/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/victory_6.png"},ok:{1:cdn_url+"/42c04/img/unread/empty/twitter/ok_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/ok_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/ok_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/ok_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/ok_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/ok_6.png"},rocket:cdn_url+"/42c04/img/unread/empty/twitter/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/twitter/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/twitter/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/twitter/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/twitter/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/twitter/boom.png",bee:cdn_url+"/42c04/img/unread/empty/twitter/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/twitter/clap_1.png",2:cdn_url+"/42c04/img/unread/empty/twitter/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/twitter/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/twitter/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/twitter/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/twitter/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/twitter/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/twitter/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/twitter/pony.png",chick:cdn_url+"/42c04/img/unread/empty/twitter/chick.png",sun:cdn_url+"/42c04/img/unread/empty/twitter/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/twitter/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/twitter/sweetpotato.png",leafs:cdn_url+"/7fa97/img/unread/empty/twitter/leafs.png"},emojione:{tada:cdn_url+"/42c04/img/unread/empty/emojione/tada.png",victory:{1:cdn_url+"/42c04/img/unread/empty/emojione/victory_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/victory_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/victory_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/victory_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/victory_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/victory_6.png"},ok:{1:cdn_url+"/42c04/img/unread/empty/emojione/ok_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/ok_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/ok_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/ok_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/ok_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/ok_6.png"},rocket:cdn_url+"/42c04/img/unread/empty/emojione/rocket.png",octopus:cdn_url+"/42c04/img/unread/empty/emojione/octopus.png",high5:{1:cdn_url+"/42c04/img/unread/empty/emojione/high5_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/high5_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/high5_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/high5_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/high5_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/high5_6.png"},apple:cdn_url+"/42c04/img/unread/empty/emojione/apple.png",sunglasses:cdn_url+"/42c04/img/unread/empty/emojione/sunglasses.png",thumbup:{1:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/thumbup_6.png"},boom:cdn_url+"/42c04/img/unread/empty/emojione/boom.png",bee:cdn_url+"/42c04/img/unread/empty/emojione/bee.png",clap:{1:cdn_url+"/42c04/img/unread/empty/emojione/clap_1.png",2:cdn_url+"/42c04/img/unread/empty/emojione/clap_2.png",3:cdn_url+"/42c04/img/unread/empty/emojione/clap_3.png",4:cdn_url+"/42c04/img/unread/empty/emojione/clap_4.png",5:cdn_url+"/42c04/img/unread/empty/emojione/clap_5.png",6:cdn_url+"/42c04/img/unread/empty/emojione/clap_6.png"},crystalball:cdn_url+"/42c04/img/unread/empty/emojione/crystalball.png",tractor:cdn_url+"/42c04/img/unread/empty/emojione/tractor.png",pony:cdn_url+"/42c04/img/unread/empty/emojione/pony.png",chick:cdn_url+"/42c04/img/unread/empty/emojione/chick.png",sun:cdn_url+"/42c04/img/unread/empty/emojione/sun.png",balloon:cdn_url+"/42c04/img/unread/empty/emojione/balloon.png",sweetpotato:cdn_url+"/42c04/img/unread/empty/emojione/sweetpotato.png",leafs:cdn_url+"/42c04/img/unread/empty/emojione/sweetpotato.png"}};var selected_combo=done_message_combo_options[Math.floor(Math.random()*done_message_combo_options.length)];var emoji_mode=TS.model.prefs.emoji_mode;var preferred_skintone=TS.model.prefs.preferred_skin_tone||"1";var emoji_url=selected_combo.skintone?emoji_paths[emoji_mode][selected_combo.emoji][preferred_skintone]:emoji_paths[emoji_mode][selected_combo.emoji];selected_combo.emoji_url=emoji_url;var img_element=new Image;img_element.src=selected_combo.emoji_url;_preloaded_empty_state=selected_combo};var _onResize=function(){TS.client.ui.unread.$scroller.height(TS.view.cached_wh-$("#client_header").outerHeight()-CLIENT_HEADER_OVERHANG);if(!TS.environment.supports_custom_scrollbar)TS.ui.utility.updateClosestMonkeyScroller(TS.client.ui.unread.$scroller);if(!TS.model.supports_sticky_position){_updateBannerHeight();_updateUnreadGroupPositions()}};var _onRename=function(model_ob){var group=TS.client.unread.getGroup(model_ob.id);if(group)TS.client.ui.unread.updateHeader(group)};var _getGroupElement=function(group){return TS.client.ui.unread.$unread_msgs_div.find("[data-model-id="+group.model_ob.id+"]")};var _updateStickyHeader=function(e){var current_scroll_offset=TS.client.ui.unread.$scroller.scrollTop();var groups=TS.client.ui.unread.unread_groups.toArray();if(!groups.length)return;var group_in_view=groups.reduce(function(previous_unread_group,current_unread_group){if(current_scroll_offset+CLIENT_HEADER_OVERHANG>=current_unread_group.y){return current_unread_group}else{return previous_unread_group}});if(!group_in_view)return;if(!$_currently_sticky){$_currently_sticky=group_in_view.$node;$_currently_sticky.find(".unread_group_header").css("top",_banner_height);$_currently_sticky.addClass("currently_sticky")}if($_currently_sticky!==group_in_view.$node){$_currently_sticky.find(".unread_group_header").css("top","0");$_currently_sticky.removeClass("currently_sticky");$_currently_sticky=group_in_view.$node;$_currently_sticky.find(".unread_group_header").css("top",_banner_height);$_currently_sticky.addClass("currently_sticky")}};var _updateUnreadGroupPositions=function(changes){var $unread_groups=TS.client.ui.unread.$scroller.find(".unread_group");TS.client.ui.unread.unread_groups=$unread_groups.map(function(index,unread_group){return{$node:$(unread_group),y:unread_group.offsetTop}})};var _updateBannerHeight=function(){_banner_height=$("#banner").height();if($_currently_sticky)$_currently_sticky.find(".unread_group_header").css("top",_banner_height)};var _buildTemplateArgs=function(group){return{model_ob:group.model_ob,model_ob_id:group.model_ob.id,has_new_unreads:group.new_unread_cnt>0,unread_cnt:group.total_unreads||0,new_unread_cnt:group.new_unread_cnt,marked_as_read_cnt:group.marked_as_read_cnt||0,show_footer:group.new_unread_cnt>0,name:group.model_ob.name,display_name:TS.shared.getDisplayNameForModelObNoSigns(group.model_ob),name_with_sign:TS.shared.getDisplayNameForModelOb(group.model_ob),marked_as_read:group.marked_as_read,collapsed:group.collapsed,is_channel:group.model_ob.is_channel,is_group:group.model_ob.is_group,
is_mpim:group.model_ob.is_mpim,is_im:group.model_ob.is_im,im_user:group.model_ob.user?TS.members.getMemberById(group.model_ob.user):null,supports_sticky_position:TS.model.supports_sticky_position}};var _checkToShowEmptyState=function(){if(!TS.client.unread.areAllMessagesFetched())return;var all_groups=TS.client.unread.getAllGroups();var all_channels_read=true;if(all_groups.length){all_channels_read=_.reduce(all_groups,function(result,g){return result&&g.marked_as_read},all_groups[0].marked_as_read)}if(all_channels_read)TS.client.ui.unread.displayEmptyState()};var _updateChannelHeaderCount=function(count){var str="No unread messages";if(count>=50){str="50+ messages"}else if(count>0){str=count+" "+TS.utility.pluralize(count,"message","messages")}TS.client.channel_header.updateChannelHeaderInfo(str)};var _transitionToMessages=function(){TS.client.ui.unread.$scroller.removeClass("loading");TS.client.ui.unread.$scroller.removeClass("loading-slow");TS.client.ui.unread.$scroller.addClass("transitioning");_updateChannelHeaderCount(TS.client.unread.getTotalMessagesCount());TS.client.ui.unread.updateMsgs();TS.client.ui.unread.$scroller.removeClass("transitioning")}})();
